<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OpenClawとOllamaを用いた完全ローカルAI秘書の構築記録。Discord連携からLlama 3.1への移行、トラブルシューティングの全記録。">
    <title>【完全自作】ローカルLLMで動く「もちスラ秘書」爆誕：OpenClaw × Ollama 構築戦記 | もちスラカルテ開発ブログ</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header class="site-header">
        <div class="container">
            <div class="logo"><a href="../../index.html"><img src="../../assets/logo.png" alt="Mochisura Lab Logo"><span
                        class="logo-text">Mochisura Lab</span></a></div>
            <nav class="site-nav"><a href="../../index.html#products">Products</a><a
                    href="../../index.html#knowledge">Knowledge</a><a href="../../index.html#community">Community</a><a
                    href="../../index.html#store">Store</a><a href="../index.html">Dev Blog</a><button
                    class="theme-toggle" onclick="toggleTheme()" aria-label="切替">🌙</button></nav>
        </div>
    </header>

    <main class="container">
        <article class="article-content">
            <h1 class="article-title">【完全自作】ローカルLLMで動く「もちスラ秘書」爆誕：OpenClaw × Ollama 構築戦記</h1>
            <p class="article-meta">2026-02-06 | 12 min read</p>

            <div class="tags">
                <span class="tag">OpenClaw</span>
                <span class="tag">Ollama</span>
                <span class="tag">Local LLM</span>
                <span class="tag">Discord Bot</span>
            </div>

            <div class="content">
                <p>もちスララボの「もちスラ」です。ついに、私たちの秘密基地「Project Genesis」に、専属のAI秘書が着任しました。</p>
                <p>その名は<strong>「もちスラ秘書」</strong>。彼女はクラウドのAPIを通さず、私の手元のPC（ローカル環境）で思考し、Discordを通じて会話します。プライバシーを守りつつ、賢く丁寧にサポートしてくれる理想の相棒です。
                </p>
                <p>しかし、その着任までの道のりは、技術的な落とし穴（沼）との戦いでもありました。今回は、同じようにローカルAI秘書を構築したい方、そして未来の自分への備忘録として、その格闘の記録を公開します。</p>

                <hr>

                <h2>🛠 構築スタック：OpenClaw × Ollama</h2>
                <p>今回採用したのは、以下の強力な組み合わせです。</p>
                <ul>
                    <li><strong>LLM Engine:</strong> <a href="https://ollama.com/">Ollama</a> (Llama 3.1 8Bベース)</li>
                    <li><strong>Agent Gateway:</strong> <a href="https://github.com/openclaw/openclaw">OpenClaw</a></li>
                    <li><strong>Interface:</strong> Discord</li>
                </ul>
                <p>OpenClawは非常に多機能なゲートウェイですが、ローカルLLMとの連携にはいくつか「特有の作法」が必要でした。</p>

                <hr>

                <h2>⚡ 遭遇した4つの壁と、その突破口</h2>

                <h3>1. Discordの「沈黙」とインテントの壁</h3>
                <p>最初の関問は、ボットがログインしているのに、話しかけても「無視」されることでした。これはDiscordの権限設定（インテント）の問題です。</p>
                <p><strong>解決策</strong>：Discord Developer
                    Portalで<code>Message Content Intent</code>をONにする。当たり前のように思えて、忘れがちな盲点でした。</p>

                <h3>2. ツール呼び出し（Function Calling）の壁</h3>
                <p>当初、独自のModelfileで構築したモデルを使っていましたが、OpenClaw経由で<code>400 Bad Request</code>が発生。Ollamaが「ツール呼び出しに対応していない」と悲鳴を上げていました。
                </p>
                <p><strong>解決策</strong>：ベースモデルをネイティブでTool Callingに対応している<strong>Llama
                        3.1</strong>へ移行。これにより、ボットが「考える（推論）」だけでなく「行動する（ツール利用）」ための道が開けました。</p>

                <h3>3. 「記憶」の容量（Context Window）の壁</h3>
                <p>ボットの応答が技術的なJSONの垂れ流しになったり、支離滅裂になる現象が発生。原因は<code>num_ctx</code>（コンテキスト窓）がデフォルトで2048トークンと極端に狭く、指示が収まりきっていなかったことでした。
                </p>
                <p><strong>解決策</strong>：<code>openclaw.json</code>と<code>Modelfile</code>の両方で<code>contextWindow</code>を<strong>32,768</strong>に拡大。これで長文の会話も安定してこなせるようになりました。
                </p>

                <h3>4. メンション不要設定のワイルドカード化</h3>
                <p>サーバーごとにメンションなしで反応させたい場合、特定のGuild IDを指定するだけでは不十分でした。</p>
                <p><strong>解決策</strong>：<code>openclaw.json</code>で
                    <code>"guilds": { "*": { "requireMention": false } }</code>
                    と記述。ワイルドカードを使うことで、すべての戦域（チャンネル）で秘書があなたの言葉を拾えるようになります。</p>

                <hr>

                <h2>✨ 最後に：ローカルLLMの自由と責任</h2>
                <p>構築を終えて感じたのは、ローカル環境でLLMを動かすことの圧倒的な自由度です。指示（Modelfile）一つで、彼女は厳格な秘書にも、知識豊富な賢者にもなります。今回、一時的に「リミッター」を解除する実験も行いましたが、それはローカルだからこそできる「AIの可能性」の探求でもありました。※現在は安全な秘書モードに戻しています。
                </p>

                <p>「もちスラ秘書」は、これからもProject Genesisの歴史を共に刻んでいくことでしょう。</p>

                <p>もしあなたが、クラウドAIの返答に物足りなさや不安を感じているなら、ぜひ「ローカルAI」の世界へ足を踏み入れてみてください。</p>

                <p><strong>Mochisura Lab｜もちスラ</strong></p>
            </div>
        </article>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2026 もちスラカルテ | Built with ❤️ and Open Source Power</p>
        </div>
    </footer>

    <script>
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.querySelector('.theme-toggle').textContent = isDark ? '☀️' : '🌙';
        }

        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-toggle').textContent = '☀️';
        }
    </script>
</body>

</html>